<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>E-LegalBoom Intake</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f7fb;
  margin: 0;
  padding: 0;
}
.container {
  max-width: 900px;
  margin: 40px auto;
  background: white;
  padding: 30px;
  border-radius: 8px;
}
h2 { color: #1f2d3d; }
input, textarea {
  width: 100%;
  margin-bottom: 12px;
  padding: 10px;
}
button {
  padding: 12px 20px;
  background: #004aad;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}
button:hover { background: #003080; }
</style>

</head>
<body>

<div class="container">
<h2>Personal & Business Intake</h2>

<form id="intake-form">

<input name="first_name" placeholder="First Name" required />
<input name="last_name" placeholder="Last Name" required />
<input name="email" type="email" placeholder="Email" required />
<input name="phone" placeholder="Phone (optional)" />
<input name="business_name" placeholder="Business Name" />
<input name="state" placeholder="Primary State" required />
<textarea name="notes" placeholder="Anything else we should know?"></textarea>

<button type="submit">Continue to Payment</button>

</form>
</div>

<script>
// =============================
// ðŸ”¹ SUPABASE CONFIG (EDIT ONLY THESE TWO LINES)
// =============================

const SUPABASE_URL = "https://vvjbjfltqsivvxxifnvi.supabase.co";

// =============================

const supabase = supabaseJs.createClient(const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ2amJqZmx0cXNpdnZ4eGlmbnZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5NzYzNTAsImV4cCI6MjA3MzU1MjM1MH0.F4zzcpCHl9v-Rnj0wgKJ5zBf1HteVyXelMLQDDEN28Q";, SUPABASE_ANON_KEY);

// Read tier from URL ?tier=Tier1 etc
const tierValue = new URLSearchParams(window.location.search).get("tier") || null;

document.getElementById("intake-form").addEventListener("submit", async (e) => {
  e.preventDefault();

  const payload = {
    first_name: document.querySelector('[name="first_name"]').value,
    last_name: document.querySelector('[name="last_name"]').value,
    email: document.querySelector('[name="email"]').value,
    phone: document.querySelector('[name="phone"]').value,
    business_name: document.querySelector('[name="business_name"]').value,
    state: document.querySelector('[name="state"]').value,
    notes: document.querySelector('[name="notes"]').value
  };

  try {

    // Insert customer
    const { data: customer, error: customerError } = await supabase
      .from("customers")
      .insert(payload)
      .select()
      .single();

    if (customerError) throw customerError;

    // Insert intake
    const { data: intake, error: intakeError } = await supabase
      .from("intakes")
      .insert({
        customer_id: customer.id,
        tier: tierValue,
        intake_data: payload,
        status: "submitted"
      })
      .select()
      .single();

    if (intakeError) throw intakeError;

    // Redirect to payment
    window.location.href = `payment.html?tier=${encodeURIComponent(tierValue)}&intake_id=${intake.id}`;

  } catch (err) {
    console.error("Supabase error:", err);
    alert("Submission failed. Check console.");
  }
});
</script>

</body>
</html>
