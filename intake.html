<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Secure Intake | E-LegalBoom</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="stylesheet" href="style.css" />

  <style>
    :root {
      --brand-orange: #ff7a3c;
      --brand-orange-dark: #e55f1f;
      --brand-blue: #213a7a;
      --bg-light: #f5f7fb;
      --border-soft: #d7d9e5;
      --text-main: #222638;
      --text-soft: #5b6073;
    }

    * { box-sizing: border-box; }

    body.page-intake {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg-light);
      color: var(--text-main);
    }

    .site-header {
      background: #ffffff;
      border-bottom: 1px solid #e1e4f0;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .site-header .container {
      max-width: 1120px;
      margin: 0 auto;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .site-logo {
      margin: 0;
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--brand-blue);
    }

    .site-nav a {
      margin-left: 16px;
      text-decoration: none;
      color: var(--text-soft);
      font-weight: 500;
      font-size: 0.95rem;
    }

    .site-nav a:hover { color: var(--brand-blue); }

    main { padding-bottom: 40px; }

    .hero-small {
      background: linear-gradient(135deg, #f5f7ff, #e7f2ff);
      border-bottom: 1px solid #dde2f2;
    }

    .hero-small .container {
      max-width: 1120px;
      margin: 0 auto;
      padding: 18px 16px 14px;
    }

    .step-indicator {
      margin: 0 0 4px;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--brand-orange);
    }

    .hero-small h2 {
      margin: 0 0 4px;
      font-size: 1.6rem;
    }

    .section-subtitle {
      margin: 0;
      font-size: 0.95rem;
      color: var(--text-soft);
      max-width: 640px;
    }

    .section { margin-top: 16px; }

    .section .container {
      max-width: 1120px;
      margin: 0 auto;
      padding: 0 16px;
    }

    .intake-form { margin-top: 8px; }

    .two-column-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
      gap: 20px;
      align-items: flex-start;
    }

    .section-block {
      background: #ffffff;
      border-radius: 12px;
      padding: 18px 20px 16px;
      margin-bottom: 16px;
      box-shadow: 0 8px 20px rgba(20, 34, 80, 0.06);
      border: 1px solid #e3e6f2;
    }

    .section-block h3 {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 1.15rem;
      color: var(--brand-blue);
    }

    .section-block > p {
      margin-top: 0;
      margin-bottom: 14px;
      font-size: 0.95rem;
      color: var(--text-soft);
    }

    .field-row {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }

    .field-group {
      flex: 1 1 220px;
      display: flex;
      flex-direction: column;
      margin-bottom: 12px;
    }

    label {
      font-size: 0.86rem;
      font-weight: 600;
      margin-bottom: 4px;
      color: var(--text-main);
    }

    .required { color: var(--brand-orange); }

    input,
    select,
    textarea {
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid var(--border-soft);
      font-size: 0.9rem;
      font-family: inherit;
      color: var(--text-main);
      background: #ffffff;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--brand-blue);
      box-shadow: 0 0 0 1px rgba(33, 58, 122, 0.15);
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    .primary-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 10px 24px;
      border-radius: 999px;
      border: none;
      background: var(--brand-orange);
      color: #ffffff;
      font-size: 0.98rem;
      font-weight: 600;
      cursor: pointer;
      min-width: 260px;
    }

    .primary-button:hover { background: var(--brand-orange-dark); }

    .primary-button:disabled {
      opacity: 0.7;
      cursor: default;
    }

    .small-print {
      margin-top: 8px;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .form-message {
      margin-top: 8px;
      font-size: 0.85rem;
    }

    .form-message.error { color: #b00020; }
    .form-message.success { color: #0f7b3f; }

    .site-footer {
      border-top: 1px solid #dde1f0;
      padding: 14px 0;
      background: #ffffff;
      margin-top: 24px;
    }

    .site-footer .container {
      max-width: 1120px;
      margin: 0 auto;
      padding: 0 16px;
      font-size: 0.82rem;
      color: var(--text-soft);
    }

    @media (max-width: 800px) {
      .two-column-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    @media (max-width: 640px) {
      .site-header .container {
        flex-direction: column;
        align-items: flex-start;
        gap: 6px;
      }
      .site-nav a {
        margin-left: 0;
        margin-right: 12px;
      }
      .primary-button {
        width: 100%;
      }
    }
  </style>
</head>

<body class="page-intake">
  <header class="site-header">
    <div class="container">
      <h1 class="site-logo">E-LegalBoom</h1>
      <nav class="site-nav">
        <a href="index.html">Home</a>
        <a href="catalog.html">Catalog</a>
        <a href="howitworks.html">How It Works</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="hero-small">
      <div class="container">
        <p class="step-indicator">Step 2 of 3</p>
        <h2>Personal &amp; Business Intake</h2>
        <p class="section-subtitle">
          This intake gives us the information we need to prepare the right document for the right tier, based on your situation.
        </p>
      </div>
    </section>

    <section class="section">
      <div class="container">
        <p id="form-message" class="form-message" aria-live="polite"></p>

        <form id="intake-form" class="intake-form">
          <div class="two-column-grid">
            <!-- 1. Personal & Business Information -->
            <div class="section-block">
              <h3>1. Personal &amp; Business Information</h3>

              <div class="field-row">
                <div class="field-group">
                  <label for="first_name">First Name <span class="required">*</span></label>
                  <input type="text" id="first_name" name="first_name" required>
                </div>
                <div class="field-group">
                  <label for="last_name">Last Name <span class="required">*</span></label>
                  <input type="text" id="last_name" name="last_name" required>
                </div>
              </div>

              <div class="field-row">
                <div class="field-group">
                  <label for="email">Email <span class="required">*</span></label>
                  <input type="email" id="email" name="email" required>
                </div>
                <div class="field-group">
                  <label for="phone">Phone (optional)</label>
                  <input type="tel" id="phone" name="phone">
                </div>
              </div>

              <div class="field-row">
                <div class="field-group">
                  <label for="business_name">Business Name (if any)</label>
                  <input type="text" id="business_name" name="business_name">
                </div>
                <div class="field-group">
                  <label for="primary_state">Primary State <span class="required">*</span></label>
                  <input type="text" id="primary_state" name="primary_state" placeholder="e.g., CA, TX, NY" required>
                </div>
              </div>

              <div class="field-group">
                <label for="personal_notes">Anything specific we should know?</label>
                <textarea id="personal_notes" name="personal_notes" rows="3"
                  placeholder="Example: I'm lending money to my cousin for a truck purchase; we'd like payments monthly."></textarea>
              </div>
            </div>

            <!-- 2. Legal & Document Details -->
            <div class="section-block">
              <h3>2. Legal &amp; Document Details</h3>
              <p>Tell us what kind of help you need so we can prepare the right document for you.</p>

              <div class="field-row">
                <div class="field-group">
                  <label for="tier">Package / Tier <span class="required">*</span></label>
                  <select id="tier" name="tier" required>
                    <option value="">Select your package...</option>
                    <option value="TIER1">Tier 1 â€“ Single Document</option>
                    <option value="TIER2">Tier 2 â€“ Bundle</option>
                    <option value="TIER3">Tier 3 â€“ Ongoing</option>
                    <option value="BUNDLE">Entrepreneur Package</option>
                  </select>
                </div>

                <div class="field-group">
                  <label for="service_type">Service type <span class="required">*</span></label>
                  <select id="service_type" name="service_type" required>
                    <option value="">What are you looking for?</option>
                    <option value="formation">Business formation / startup</option>
                    <option value="contract">Contract / agreement</option>
                    <option value="compliance">Compliance / policy</option>
                    <option value="finance">Money owed / payment terms</option>
                    <option value="other">Other / not sure</option>
                  </select>
                </div>
              </div>

              <!-- OPTIONAL helper dropdown -->
              <div class="field-group">
                <label for="document_template">
                  Document type (optional helper)
                </label>
                <select id="document_template" name="document_template">
                  <option value="">Select Tier First</option>
                </select>
                <small style="font-size: 0.8rem; color: var(--text-soft); margin-top: 4px;">
                  You can pick from this list or simply describe your document below.
                </small>
              </div>

              <!-- REQUIRED: this is what you actually use to prepare the doc -->
              <div class="field-group">
                <label for="document_purpose">
                  Document you need or main purpose <span class="required">*</span>
                </label>
                <input
                  type="text"
                  id="document_purpose"
                  name="document_purpose"
                  placeholder="Example: Mutual NDA for potential partner; Promissory Note for $70,000; Single-Member LLC Agreement"
                  required
                >
              </div>

              <div class="field-row">
                <div class="field-group">
                  <label for="other_party">Name of the other party</label>
                  <input type="text" id="other_party" name="other_party"
                         placeholder="Company or person on the other side">
                </div>
                <div class="field-group">
                  <label for="effective_date">Effective date (if known)</label>
                  <input type="date" id="effective_date" name="effective_date">
                </div>
              </div>

              <div class="field-row">
                <div class="field-group">
                  <label for="jurisdiction">Governing state / jurisdiction</label>
                  <input type="text" id="jurisdiction" name="jurisdiction" placeholder="e.g., CA, TX, FL">
                </div>
                <div class="field-group">
                  <label for="urgency">How urgent is this?</label>
                  <select id="urgency" name="urgency">
                    <option value="normal">Normal (5â€“7 business days)</option>
                    <option value="rush">Rush (2â€“3 business days)</option>
                    <option value="urgent">Urgent (within 48 hours)</option>
                  </select>
                </div>
              </div>

              <div class="field-group">
                <label for="situation_summary">
                  Briefly describe what you need this document to cover <span class="required">*</span>
                </label>
                <textarea id="situation_summary" name="situation_summary" rows="4" required
                  placeholder="Share the situation in plain language. We'll translate it into legal structure."></textarea>
              </div>

              <div class="field-group">
                <label for="key_terms">Key names, terms, or clauses you want included (optional)</label>
                <textarea id="key_terms" name="key_terms" rows="3"
                  placeholder="Example: 12-month term, 30-day notice, late fees after 10 days, etc."></textarea>
              </div>
            </div>
          </div>

          <div class="section-block">
            <button type="submit" id="submit-btn" class="primary-button">
              Continue to Secure Payment
            </button>
            <p class="small-print">
              You will not be charged on this page. Weâ€™ll guide you through information first, then payment at the end.
            </p>
          </div>
        </form>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">
      <p>Â© <span id="year"></span> E-LegalBoom. All rights reserved.</p>
    </div>
  </footer>

  <!-- Supabase client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // ðŸ”‘ Supabase config â€“ you can leave these as placeholders while we test the page flow.
    const SUPABASE_URL = "PUT_YOUR_SUPABASE_URL_HERE";
    const SUPABASE_ANON_KEY = "PUT_YOUR_SUPABASE_ANON_KEY_HERE";

    let supabaseClient = null;
    const hasRealSupabase =
      SUPABASE_URL.startsWith("https://") &&
      !SUPABASE_URL.includes("PUT_YOUR") &&
      SUPABASE_ANON_KEY &&
      !SUPABASE_ANON_KEY.includes("PUT_YOUR");

    if (hasRealSupabase) {
      const { createClient } = window.supabase;
      supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    }

    // Current year
    const yearEl = document.getElementById('year');
    if (yearEl) yearEl.textContent = new Date().getFullYear();

    // ---------- Tier â†’ helper document list (OPTIONAL) ----------

    const DOCS_BY_TIER = {
      TIER1: [
        'Mutual NDA (Non-Disclosure Agreement)',
        'Promissory Note',
        'Single-Member LLC Operating Agreement',
        'Simple Payment / IOU Agreement',
        'Independent Contractor / Basic Service Agreement'
      ],
      TIER2: [
        'Partnership Agreement',
        'Service / Contractor Agreement',
        'Two-Party Promissory Note',
        'Operating Agreement + NDA'
      ],
      TIER3: [
        'Launch Package (LLC + Agreements)',
        'Ongoing Service / Retainer Agreement',
        'Compliance / Policy Bundle'
      ],
      BUNDLE: [
        'Entrepreneur Starter Bundle â€“ LLC + Promissory + Service',
        'Full Startup Kit'
      ]
    };

    function normalizeTier(value) {
      if (!value) return '';
      return value.toString().trim().toUpperCase().replace(/\s+/g, '');
    }

    function populateDocumentTemplate() {
      const tierSelect = document.getElementById('tier');
      const templateSelect = document.getElementById('document_template');
      if (!tierSelect || !templateSelect) return;

      const tierKey = normalizeTier(tierSelect.value);
      const docs = DOCS_BY_TIER[tierKey] || [];

      // Clear existing
      templateSelect.innerHTML = '';

      const placeholder = document.createElement('option');
      placeholder.value = '';
      placeholder.textContent = docs.length ? 'Select document typeâ€¦' : 'Select Tier First';
      placeholder.selected = true;
      templateSelect.appendChild(placeholder);

      docs.forEach(label => {
        const opt = document.createElement('option');
        opt.value = label;
        opt.textContent = label;
        templateSelect.appendChild(opt);
      });
    }

    // When they pick a template, copy it into the required text field so you know what to prepare
    const docTemplateEl = document.getElementById('document_template');
    const docPurposeEl = document.getElementById('document_purpose');

    if (docTemplateEl && docPurposeEl) {
      docTemplateEl.addEventListener('change', function () {
        if (this.value) {
          // Always copy into the purpose field; they can edit further
          docPurposeEl.value = this.value;
        }
      });
    }

    // ---------- Auto-select tier from ?tier=... ----------

    (function autoSelectTierFromQuery() {
      const tierSelect = document.getElementById('tier');
      if (!tierSelect) return;

      const params = new URLSearchParams(window.location.search);
      const raw = params.get('tier');
      if (!raw) return;

      const t = normalizeTier(raw);

      if (t === '1' || t === 'TIER1') tierSelect.value = 'TIER1';
      else if (t === '2' || t === 'TIER2') tierSelect.value = 'TIER2';
      else if (t === '3' || t === 'TIER3') tierSelect.value = 'TIER3';
      else if (t === 'BUNDLE' || t === 'ENTREPRENEURPACKAGE' || t === 'ENTREPRENEUR')
        tierSelect.value = 'BUNDLE';
    })();

    // Populate helper docs whenever tier changes
    const tierSelectEl = document.getElementById('tier');
    if (tierSelectEl) {
      tierSelectEl.addEventListener('change', populateDocumentTemplate);
    }
    // And once on load (handles pre-selected tier)
    populateDocumentTemplate();

    // ---------- Form submit handler ----------

    const form = document.getElementById('intake-form');
    const submitBtn = document.getElementById('submit-btn');
    const messageEl = document.getElementById('form-message');

    if (form) {
      form.addEventListener('submit', async function (e) {
        e.preventDefault();

        if (messageEl) {
          messageEl.textContent = '';
          messageEl.className = 'form-message';
        }
        if (submitBtn) {
          submitBtn.disabled = true;
          submitBtn.textContent = 'Saving...';
        }

        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());

        let intakeId = null;

        try {
          if (supabaseClient) {
            const { data: rows, error } = await supabaseClient
              .from('intakes')
              .insert([data])
              .select();

            if (error) throw error;
            if (rows && rows.length) intakeId = rows[0].id;
          }
        } catch (err) {
          console.error('Supabase error:', err);
          if (messageEl) {
            messageEl.textContent =
              'We received your intake on the next page, but there was an issue saving a copy in our system. You may continue to payment, and we will follow up manually if needed.';
            messageEl.classList.add('error');
          }
        }

        const tierValue = data.tier || '';
        const params = new URLSearchParams();
        if (tierValue) params.set('tier', tierValue);
        if (intakeId) params.set('intake_id', intakeId);

        const target = 'payment.html' + (params.toString() ? '?' + params.toString() : '');
        window.location.href = target;
      });
    }
  </script>
</body>
</html>
