<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Secure Intake | E-LegalBoom</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">

<style>
body { background:#f5f7fb; font-family:system-ui; }
.container { max-width:1150px; margin:30px auto; padding:20px; }
.grid { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
.card { background:#fff; border-radius:10px; padding:20px; box-shadow:0 8px 20px rgba(0,0,0,.05); }
label { display:block; font-weight:600; margin-top:10px; }
input, textarea, select {
  width:100%; padding:8px; border-radius:6px;
  border:1px solid #cbd5e1; margin-top:4px;
}
button {
  background:#2563eb; color:#fff; border:none;
  padding:12px 32px; border-radius:999px;
  font-size:16px; cursor:pointer; margin-top:20px;
}
.error { background:#fee2e2; color:#7f1d1d; padding:10px; margin-bottom:12px; border-radius:6px; display:none; }
</style>
</head>

<body>
<div class="container">
<div id="errorBox" class="error"></div>

<form id="intakeForm">

<div class="grid">

<!-- PERSONAL -->
<div class="card">
<h3>1. Personal & Business Info</h3>

<label>First Name *</label>
<input name="first_name" required>

<label>Last Name *</label>
<input name="last_name" required>

<label>Email *</label>
<input type="email" name="email" required>

<label>Phone</label>
<input name="phone">

<label>Business Name</label>
<input name="business_name">

<label>Primary State *</label>
<input name="primary_state" required>

<label>Notes</label>
<textarea name="personal_notes"></textarea>
</div>

<!-- LEGAL -->
<div class="card">
<h3>2. Legal & Document Details</h3>

<label>Tier *</label>
<select name="tier" id="tier" required>
<option value="">Select Tier</option>
<option value="TIER1">Tier 1</option>
<option value="TIER2">Tier 2</option>
<option value="TIER3">Tier 3</option>
<option value="BUNDLE">Entrepreneur Bundle</option>
</select>

<label>Service Type *</label>
<select name="service_type" required>
<option value="">Choose</option>
<option value="formation">Formation</option>
<option value="contract">Contract</option>
<option value="compliance">Compliance</option>
<option value="finance">Finance</option>
<option value="other">Other</option>
</select>

<label>Document Type *</label>
<select name="document_purpose" id="docType" required>
<option value="">Select Tier First</option>
</select>

<label>Other Party</label>
<input name="other_party">

<label>Effective Date</label>
<input type="date" name="effective_date">

<label>Jurisdiction</label>
<input name="jurisdiction">

<label>Urgency</label>
<select name="urgency">
<option value="normal">Normal</option>
<option value="rush">Rush</option>
<option value="urgent">Urgent</option>
</select>

<label>Situation Summary *</label>
<textarea name="situation_summary" required></textarea>

<label>Key Terms / Amounts</label>
<textarea name="key_terms"></textarea>

</div>
</div>

<button type="submit">Continue to Payment</button>
</form>

</div>

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>

const SUPABASE_URL = "https://vvjbjfltqsivvxxifnvi.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ2amJqZmx0cXNpdnZ4eGlmbnZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5NzYzNTAsImV4cCI6MjA3MzU1MjM1MH0.F4zzcpCHl9v-Rnj0wgKJ5zBf1HteVyXelMLQDDEN28Q";

const supabase = supabaseJs.createClient(SUPABASE_URL, SUPABASE_KEY);

// Tier â†’ Doc options
const DOCS = {
 TIER1:["NDA","Promissory Note","Single-Member LLC"],
 TIER2:["Partnership Agreement","Service Agreement","Operating Agreement"],
 TIER3:["Launch Package","Compliance Suite","Document Membership"],
 BUNDLE:["Full Startup Kit","All Legal Docs"]
};

document.getElementById("tier").addEventListener("change", function(){
 const box=document.getElementById("docType");
 box.innerHTML="<option value=''>Select</option>";
 (DOCS[this.value]||[]).forEach(d=>box.innerHTML += `<option>${d}</option>`);
});

document.getElementById("intakeForm").addEventListener("submit", async e=>{
e.preventDefault();
const msg=document.getElementById("errorBox");
msg.style.display="none";

const data=Object.fromEntries(new FormData(e.target));

try{
 const { error } = await supabase.from("intakes").insert([data]);
 if(error) throw error;
 window.location.href="payment.html?tier="+data.tier;
}catch(err){
 console.error(err);
 msg.innerText="We received your intake but could not save it. Continuing to payment.";
 msg.style.display="block";
 window.location.href="payment.html?tier="+data.tier;
}
});
</script>

</body>
</html>
